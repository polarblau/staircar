<!doctype html>
<html>
	<head>
		<title>Downloadify Polyfill Test</title>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

		<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

		<script type="text/javascript" src="js/swfobject.js"></script>
		<script type="text/javascript" src="src/downloadify.js"></script>

		<style>
			body {
				width: 60%;
				margin: 50px auto;
			}
		</style>

		<script>

			// Hard coded JSON response.
			var DATA = [
				{
					"Header 1": "Data 1",
					"Header 2": "Data 2",
					"Header 3": "Data 3"
				},
				{
					"Header 1": "Data 4",
					"Header 2": "Data 5",
					"Header 3": "Data 6"
				},
				{
					"Header 1": "Data 7",
					"Header 2": "Data 8",
					"Header 3": "Data 9"
				}
			];

			$(document).on("click", "#download-btn", function () {

				// Convert JSON to CSV.
				var csv = JsonToCsv(DATA);

				$("#downloadify-element").downloadify({
					data: csv,
					filename: "download.csv",
					mimeType: "text/csv",
					afterInit: function() {
						$("#downloadify-modal").modal();
					}
				});
			});

function JsonToCsv(json) {

	var csv = '';

	// Begin with the header row, using
	// the keys.
	for (var key in json[0]) {

		csv += key + ',';
	}

	// Cut off the trailing comma.
	csv = csv.substring(0, csv.length-1);

	csv += '\r\n';

	// Iterate through the rows.
	for (var i=0; i<json.length; i++) {

		var line = '';
		for (var key in json[i]) {

			if (line != '') {
				line += ',';
			}

		    line += json[i][key];
		}

		csv += line + '\r\n';
	}

	return csv;
}

		</script>


	</head>

	<body>

		<h1>Downloadify Test</h1>

		<p>Download some test JSON data as CSV (hard coded in a <code>script</code>
			element).
		</p>

		<p>
			If your browser supports downloading data URIs, the download will
			be pure JavaScript. Otherwise, it'll fall back to Flash.
		</p>

		<button id="download-btn" type="button" class="btn btn-primary">Export (CSV)</button>

		<div id="downloadify-modal" class="modal fade">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		        <h4 class="modal-title">Your Download Is Ready</h4>
		      </div>
		      <div class="modal-body">
				<p id="downloadify-element" style="text-align: center;">
					<strong>Your browser doesn't support downloading this file.</strong><br/>
				    Upgrade to a more modern browser, like <a href="http://www.google.com/chrome" target="_blank">Chrome</a> or <a href="http://www.getfirefox.com" target="_blank">Firefox</a>, or <a href="http://get.adobe.com/flashplayer" target="_blank">download Flash Player</a>. 
				    </p>
		      </div>

		    </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

	
	</body>
</html>
